{"version":3,"sources":["/home/circleci/project/packages/blocks/src/store/reducer.js"],"names":["keyBy","omit","mapValues","get","uniqBy","filter","map","combineReducers","__","DEFAULT_CATEGORIES","slug","title","blockTypes","state","action","type","blockType","names","blockStyles","name","style","blockName","styles","styleNames","indexOf","createBlockNameSetterReducer","setActionType","defaultBlockName","freeformFallbackBlockName","unregisteredFallbackBlockName","categories"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { keyBy, omit, mapValues, get, uniqBy, filter, map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Module Constants\n */\nexport const DEFAULT_CATEGORIES = [\n\t{ slug: 'common', title: __( 'Common Blocks' ) },\n\t{ slug: 'formatting', title: __( 'Formatting' ) },\n\t{ slug: 'layout', title: __( 'Layout Elements' ) },\n\t{ slug: 'widgets', title: __( 'Widgets' ) },\n\t{ slug: 'embed', title: __( 'Embeds' ) },\n\t{ slug: 'reusable', title: __( 'Reusable Blocks' ) },\n];\n\n/**\n * Reducer managing the block types\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockTypes( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...keyBy(\n\t\t\t\t\tmap( action.blockTypes, ( blockType ) => omit( blockType, 'styles ' ) ),\n\t\t\t\t\t'name'\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\treturn omit( state, action.names );\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the block style variations.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockStyles( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...mapValues( keyBy( action.blockTypes, 'name' ), ( blockType ) => {\n\t\t\t\t\treturn uniqBy( [\n\t\t\t\t\t\t...get( blockType, [ 'styles' ], [] ),\n\t\t\t\t\t\t...get( state, [ blockType.name ], [] ),\n\t\t\t\t\t], ( style ) => style.name );\n\t\t\t\t} ),\n\t\t\t};\n\t\tcase 'ADD_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: uniqBy( [\n\t\t\t\t\t...get( state, [ action.blockName ], [] ),\n\t\t\t\t\t...( action.styles ),\n\t\t\t\t], ( style ) => style.name ),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: filter(\n\t\t\t\t\tget( state, [ action.blockName ], [] ),\n\t\t\t\t\t( style ) => action.styleNames.indexOf( style.name ) === -1,\n\t\t\t\t),\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher-order Reducer creating a reducer keeping track of given block name.\n *\n * @param {string} setActionType  Action type.\n *\n * @return {function} Reducer.\n */\nexport function createBlockNameSetterReducer( setActionType ) {\n\treturn ( state = null, action ) => {\n\t\tswitch ( action.type ) {\n\t\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\t\tif ( action.names.indexOf( state ) !== -1 ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn state;\n\n\t\t\tcase setActionType:\n\t\t\t\treturn action.name || null;\n\t\t}\n\n\t\treturn state;\n\t};\n}\n\nexport const defaultBlockName = createBlockNameSetterReducer( 'SET_DEFAULT_BLOCK_NAME' );\nexport const freeformFallbackBlockName = createBlockNameSetterReducer( 'SET_FREEFORM_FALLBACK_BLOCK_NAME' );\nexport const unregisteredFallbackBlockName = createBlockNameSetterReducer( 'SET_UNREGISTERED_FALLBACK_BLOCK_NAME' );\n\n/**\n * Reducer managing the categories\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function categories( state = DEFAULT_CATEGORIES, action ) {\n\tif ( action.type === 'SET_CATEGORIES' ) {\n\t\treturn action.categories || [];\n\t}\n\n\treturn state;\n}\n\nexport default combineReducers( {\n\tblockTypes,\n\tblockStyles,\n\tdefaultBlockName,\n\tfreeformFallbackBlockName,\n\tunregisteredFallbackBlockName,\n\tcategories,\n} );\n"]}