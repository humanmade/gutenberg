{"version":3,"sources":["/home/circleci/project/packages/editor/src/components/provider/index.js"],"names":["flow","map","compose","createElement","Component","DropZoneProvider","SlotFillProvider","withDispatch","__","traverse","wrap","urlRewrite","EditorProvider","props","arguments","recovery","updateEditorSettings","settings","updatePostLock","postLock","setupEditor","post","initialEdits","autosave","createWarningNotice","id","actions","label","url","editLink","styles","css","baseURL","transforms","push","updatedCSS","node","document","innerHTML","body","appendChild","prevProps","children","providers","createEditorElement","Provider","arg","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { flow, map } from 'lodash';\n\n/**\n * WordPress Dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport { createElement, Component } from '@wordpress/element';\nimport { DropZoneProvider, SlotFillProvider } from '@wordpress/components';\nimport { withDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { traverse, wrap, urlRewrite } from '../../editor-styles';\n\nclass EditorProvider extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\t// Assume that we don't need to initialize in the case of an error recovery.\n\t\tif ( props.recovery ) {\n\t\t\treturn;\n\t\t}\n\n\t\tprops.updateEditorSettings( props.settings );\n\t\tprops.updatePostLock( props.settings.postLock );\n\t\tprops.setupEditor( props.post, props.initialEdits );\n\n\t\tif ( props.settings.autosave ) {\n\t\t\tprops.createWarningNotice(\n\t\t\t\t__( 'There is an autosave of this post that is more recent than the version below.' ),\n\t\t\t\t{\n\t\t\t\t\tid: 'autosave-exists',\n\t\t\t\t\tactions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __( 'View the autosave' ),\n\t\t\t\t\t\t\turl: props.settings.autosave.editLink,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif ( ! this.props.settings.styles ) {\n\t\t\treturn;\n\t\t}\n\n\t\tmap( this.props.settings.styles, ( { css, baseURL } ) => {\n\t\t\tconst transforms = [\n\t\t\t\twrap( '.editor-styles-wrapper' ),\n\t\t\t];\n\t\t\tif ( baseURL ) {\n\t\t\t\ttransforms.push( urlRewrite( baseURL ) );\n\t\t\t}\n\t\t\tconst updatedCSS = traverse( css, compose( transforms ) );\n\t\t\tif ( updatedCSS ) {\n\t\t\t\tconst node = document.createElement( 'style' );\n\t\t\t\tnode.innerHTML = updatedCSS;\n\t\t\t\tdocument.body.appendChild( node );\n\t\t\t}\n\t\t} );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( this.props.settings !== prevProps.settings ) {\n\t\t\tthis.props.updateEditorSettings( this.props.settings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t} = this.props;\n\n\t\tconst providers = [\n\t\t\t// Slot / Fill provider:\n\t\t\t//\n\t\t\t//  - context.getSlot\n\t\t\t//  - context.registerSlot\n\t\t\t//  - context.unregisterSlot\n\t\t\t[\n\t\t\t\tSlotFillProvider,\n\t\t\t],\n\n\t\t\t// DropZone provider:\n\t\t\t[\n\t\t\t\tDropZoneProvider,\n\t\t\t],\n\t\t];\n\n\t\tconst createEditorElement = flow(\n\t\t\tproviders.map( ( [ Provider, props ] ) => (\n\t\t\t\t( arg ) => createElement( Provider, props, arg )\n\t\t\t) )\n\t\t);\n\n\t\treturn createEditorElement( children );\n\t}\n}\n\nexport default withDispatch( ( dispatch ) => {\n\tconst {\n\t\tsetupEditor,\n\t\tupdateEditorSettings,\n\t\tupdatePostLock,\n\t} = dispatch( 'core/editor' );\n\tconst { createWarningNotice } = dispatch( 'core/notices' );\n\n\treturn {\n\t\tsetupEditor,\n\t\tupdateEditorSettings,\n\t\tupdatePostLock,\n\t\tcreateWarningNotice,\n\t};\n} )( EditorProvider );\n"]}