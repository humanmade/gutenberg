{"version":3,"sources":["/home/circleci/project/packages/editor/src/components/default-block-appender/index.js"],"names":["get","TextareaAutosize","__","compose","getDefaultBlockName","decodeEntities","withSelect","withDispatch","BlockDropZone","InserterWithShortcuts","Inserter","DefaultBlockAppender","isLocked","isVisible","onAppend","showPrompt","placeholder","rootClientId","value","select","ownProps","getBlockCount","getBlock","getEditorSettings","getTemplateLock","isEmpty","lastBlock","lastBlockClientId","isLastBlockDefault","isLastBlockValid","bodyPlaceholder","dispatch","insertDefaultBlock","startTyping","undefined"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { get } from 'lodash';\nimport TextareaAutosize from 'react-autosize-textarea';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { compose } from '@wordpress/compose';\nimport { getDefaultBlockName } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { withSelect, withDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport BlockDropZone from '../block-drop-zone';\nimport InserterWithShortcuts from '../inserter-with-shortcuts';\nimport Inserter from '../inserter';\n\nexport function DefaultBlockAppender( {\n\tisLocked,\n\tisVisible,\n\tonAppend,\n\tshowPrompt,\n\tplaceholder,\n\trootClientId,\n} ) {\n\tif ( isLocked || ! isVisible ) {\n\t\treturn null;\n\t}\n\n\tconst value = decodeEntities( placeholder ) || __( 'Start writing or type / to choose a block' );\n\n\t// The appender \"button\" is in-fact a text field so as to support\n\t// transitions by WritingFlow occurring by arrow key press. WritingFlow\n\t// only supports tab transitions into text fields and to the block focus\n\t// boundary.\n\t//\n\t// See: https://github.com/WordPress/gutenberg/issues/4829#issuecomment-374213658\n\t//\n\t// If it were ever to be made to be a proper `button` element, it is\n\t// important to note that `onFocus` alone would not be sufficient to\n\t// capture click events, notably in Firefox.\n\t//\n\t// See: https://gist.github.com/cvrebert/68659d0333a578d75372\n\n\t// The wp-block className is important for editor styles.\n\n\treturn (\n\t\t<div data-root-client-id={ rootClientId || '' } className=\"wp-block editor-default-block-appender\">\n\t\t\t<BlockDropZone rootClientId={ rootClientId } />\n\t\t\t<TextareaAutosize\n\t\t\t\trole=\"button\"\n\t\t\t\taria-label={ __( 'Add block' ) }\n\t\t\t\tclassName=\"editor-default-block-appender__content\"\n\t\t\t\treadOnly\n\t\t\t\tonFocus={ onAppend }\n\t\t\t\tvalue={ showPrompt ? value : '' }\n\t\t\t/>\n\t\t\t<InserterWithShortcuts rootClientId={ rootClientId } />\n\t\t\t<Inserter position=\"top right\" />\n\t\t</div>\n\t);\n}\nexport default compose(\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getBlockCount, getBlock, getEditorSettings, getTemplateLock } = select( 'core/editor' );\n\n\t\tconst isEmpty = ! getBlockCount( ownProps.rootClientId );\n\t\tconst lastBlock = getBlock( ownProps.lastBlockClientId );\n\t\tconst isLastBlockDefault = get( lastBlock, [ 'name' ] ) === getDefaultBlockName();\n\t\tconst isLastBlockValid = get( lastBlock, [ 'isValid' ] );\n\t\tconst { bodyPlaceholder } = getEditorSettings();\n\n\t\treturn {\n\t\t\tisVisible: isEmpty || ! isLastBlockDefault || ! isLastBlockValid,\n\t\t\tshowPrompt: isEmpty,\n\t\t\tisLocked: !! getTemplateLock( ownProps.rootClientId ),\n\t\t\tplaceholder: bodyPlaceholder,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\tinsertDefaultBlock,\n\t\t\tstartTyping,\n\t\t} = dispatch( 'core/editor' );\n\n\t\treturn {\n\t\t\tonAppend() {\n\t\t\t\tconst { rootClientId } = ownProps;\n\n\t\t\t\tinsertDefaultBlock( undefined, rootClientId );\n\t\t\t\tstartTyping();\n\t\t\t},\n\t\t};\n\t} ),\n)( DefaultBlockAppender );\n"]}