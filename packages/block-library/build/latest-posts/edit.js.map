{"version":3,"sources":["/home/circleci/project/packages/block-library/src/latest-posts/edit.js"],"names":["CATEGORIES_LIST_QUERY","per_page","MAX_POSTS_COLUMNS","LatestPostsEdit","arguments","state","categoriesList","toggleDisplayPostDate","bind","isStillMounted","fetchRequest","path","then","setState","catch","displayPostDate","props","attributes","setAttributes","latestPosts","align","postLayout","columns","order","orderBy","categories","postsToShow","inspectorControls","value","undefined","hasPosts","Math","min","length","Array","isArray","displayPosts","slice","layoutControls","icon","title","onClick","isActive","dateFormat","formats","date","nextAlign","className","map","post","i","link","rendered","trim","date_gmt","Component","select","getEntityRecords","latestPostsQuery","orderby"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { isUndefined, pickBy } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, Fragment } from '@wordpress/element';\nimport {\n\tPanelBody,\n\tPlaceholder,\n\tQueryControls,\n\tRangeControl,\n\tSpinner,\n\tToggleControl,\n\tToolbar,\n} from '@wordpress/components';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\nimport { __ } from '@wordpress/i18n';\nimport { dateI18n, format, __experimentalGetSettings } from '@wordpress/date';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport {\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockControls,\n} from '@wordpress/editor';\nimport { withSelect } from '@wordpress/data';\n\n/**\n * Module Constants\n */\nconst CATEGORIES_LIST_QUERY = {\n\tper_page: 100,\n};\nconst MAX_POSTS_COLUMNS = 6;\n\nclass LatestPostsEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\tcategoriesList: [],\n\t\t};\n\t\tthis.toggleDisplayPostDate = this.toggleDisplayPostDate.bind( this );\n\t}\n\n\tcomponentWillMount() {\n\t\tthis.isStillMounted = true;\n\t\tthis.fetchRequest = apiFetch( {\n\t\t\tpath: addQueryArgs( `/wp/v2/categories`, CATEGORIES_LIST_QUERY ),\n\t\t} ).then(\n\t\t\t( categoriesList ) => {\n\t\t\t\tif ( this.isStillMounted ) {\n\t\t\t\t\tthis.setState( { categoriesList } );\n\t\t\t\t}\n\t\t\t}\n\t\t).catch(\n\t\t\t() => {\n\t\t\t\tif ( this.isStillMounted ) {\n\t\t\t\t\tthis.setState( { categoriesList: [] } );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.isStillMounted = false;\n\t}\n\n\ttoggleDisplayPostDate() {\n\t\tconst { displayPostDate } = this.props.attributes;\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { displayPostDate: ! displayPostDate } );\n\t}\n\n\trender() {\n\t\tconst { attributes, setAttributes, latestPosts } = this.props;\n\t\tconst { categoriesList } = this.state;\n\t\tconst { displayPostDate, align, postLayout, columns, order, orderBy, categories, postsToShow } = attributes;\n\n\t\tconst inspectorControls = (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Latest Posts Settings' ) }>\n\t\t\t\t\t<QueryControls\n\t\t\t\t\t\t{ ...{ order, orderBy } }\n\t\t\t\t\t\tnumberOfItems={ postsToShow }\n\t\t\t\t\t\tcategoriesList={ categoriesList }\n\t\t\t\t\t\tselectedCategoryId={ categories }\n\t\t\t\t\t\tonOrderChange={ ( value ) => setAttributes( { order: value } ) }\n\t\t\t\t\t\tonOrderByChange={ ( value ) => setAttributes( { orderBy: value } ) }\n\t\t\t\t\t\tonCategoryChange={ ( value ) => setAttributes( { categories: '' !== value ? value : undefined } ) }\n\t\t\t\t\t\tonNumberOfItemsChange={ ( value ) => setAttributes( { postsToShow: value } ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Display post date' ) }\n\t\t\t\t\t\tchecked={ displayPostDate }\n\t\t\t\t\t\tonChange={ this.toggleDisplayPostDate }\n\t\t\t\t\t/>\n\t\t\t\t\t{ postLayout === 'grid' &&\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { columns: value } ) }\n\t\t\t\t\t\t\tmin={ 2 }\n\t\t\t\t\t\t\tmax={ ! hasPosts ? MAX_POSTS_COLUMNS : Math.min( MAX_POSTS_COLUMNS, latestPosts.length ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tconst hasPosts = Array.isArray( latestPosts ) && latestPosts.length;\n\t\tif ( ! hasPosts ) {\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t{ inspectorControls }\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon=\"admin-post\"\n\t\t\t\t\t\tlabel={ __( 'Latest Posts' ) }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ ! Array.isArray( latestPosts ) ?\n\t\t\t\t\t\t\t<Spinner /> :\n\t\t\t\t\t\t\t__( 'No posts found.' )\n\t\t\t\t\t\t}\n\t\t\t\t\t</Placeholder>\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\n\t\t// Removing posts from display should be instant.\n\t\tconst displayPosts = latestPosts.length > postsToShow ?\n\t\t\tlatestPosts.slice( 0, postsToShow ) :\n\t\t\tlatestPosts;\n\n\t\tconst layoutControls = [\n\t\t\t{\n\t\t\t\ticon: 'list-view',\n\t\t\t\ttitle: __( 'List View' ),\n\t\t\t\tonClick: () => setAttributes( { postLayout: 'list' } ),\n\t\t\t\tisActive: postLayout === 'list',\n\t\t\t},\n\t\t\t{\n\t\t\t\ticon: 'grid-view',\n\t\t\t\ttitle: __( 'Grid View' ),\n\t\t\t\tonClick: () => setAttributes( { postLayout: 'grid' } ),\n\t\t\t\tisActive: postLayout === 'grid',\n\t\t\t},\n\t\t];\n\n\t\tconst dateFormat = __experimentalGetSettings().formats.date;\n\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t{ inspectorControls }\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\t\tvalue={ align }\n\t\t\t\t\t\tonChange={ ( nextAlign ) => {\n\t\t\t\t\t\t\tsetAttributes( { align: nextAlign } );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tcontrols={ [ 'center', 'wide', 'full' ] }\n\t\t\t\t\t/>\n\t\t\t\t\t<Toolbar controls={ layoutControls } />\n\t\t\t\t</BlockControls>\n\t\t\t\t<ul\n\t\t\t\t\tclassName={ classnames( this.props.className, {\n\t\t\t\t\t\t'is-grid': postLayout === 'grid',\n\t\t\t\t\t\t'has-dates': displayPostDate,\n\t\t\t\t\t\t[ `columns-${ columns }` ]: postLayout === 'grid',\n\t\t\t\t\t} ) }\n\t\t\t\t>\n\t\t\t\t\t{ displayPosts.map( ( post, i ) =>\n\t\t\t\t\t\t<li key={ i }>\n\t\t\t\t\t\t\t<a href={ post.link } target=\"_blank\">{ decodeEntities( post.title.rendered.trim() ) || __( '(Untitled)' ) }</a>\n\t\t\t\t\t\t\t{ displayPostDate && post.date_gmt &&\n\t\t\t\t\t\t\t\t<time dateTime={ format( 'c', post.date_gmt ) } className={ `${ this.props.className }__post-date` }>\n\t\t\t\t\t\t\t\t\t{ dateI18n( dateFormat, post.date_gmt ) }\n\t\t\t\t\t\t\t\t</time>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) }\n\t\t\t\t</ul>\n\t\t\t</Fragment>\n\t\t);\n\t}\n}\n\nexport default withSelect( ( select, props ) => {\n\tconst { postsToShow, order, orderBy, categories } = props.attributes;\n\tconst { getEntityRecords } = select( 'core' );\n\tconst latestPostsQuery = pickBy( {\n\t\tcategories,\n\t\torder,\n\t\torderby: orderBy,\n\t\tper_page: postsToShow,\n\t}, ( value ) => ! isUndefined( value ) );\n\treturn {\n\t\tlatestPosts: getEntityRecords( 'postType', 'post', latestPostsQuery ),\n\t};\n} )( LatestPostsEdit );\n"]}