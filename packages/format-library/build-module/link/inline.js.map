{"version":3,"sources":["/home/circleci/project/packages/format-library/src/link/inline.js"],"names":["classnames","sprintf","__","Component","createRef","ExternalLink","IconButton","ToggleControl","withSpokenMessages","ESCAPE","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","prependHTTP","safeDecodeURI","filterURLForDisplay","create","insert","isCollapsed","applyFormat","URLInput","URLPopover","PositionedAtSelection","isValidHref","stopKeyPropagation","event","stopPropagation","createLinkFormat","url","opensInNewWindow","text","format","type","attributes","label","trim","target","rel","isShowingInput","props","state","addingLink","editLink","LinkEditor","value","onChangeInputValue","onKeyDown","submitLink","autocompleteRef","LinkViewer","prependedURL","linkClassName","InlineLinkUI","arguments","bind","setLinkTarget","onClickOutside","resetState","keyCode","indexOf","inputValue","setState","activeAttributes","onChange","preventDefault","isActive","speak","toInsert","length","autocompleteElement","current","contains","stopAddingLink","showInput","start","end"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport {\n\tExternalLink,\n\tIconButton,\n\tToggleControl,\n\twithSpokenMessages,\n} from '@wordpress/components';\nimport { ESCAPE, LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { prependHTTP, safeDecodeURI, filterURLForDisplay } from '@wordpress/url';\nimport {\n\tcreate,\n\tinsert,\n\tisCollapsed,\n\tapplyFormat,\n} from '@wordpress/rich-text';\nimport { URLInput, URLPopover } from '@wordpress/editor';\n\n/**\n * Internal dependencies\n */\nimport PositionedAtSelection from './positioned-at-selection';\nimport { isValidHref } from './utils';\n\nconst stopKeyPropagation = ( event ) => event.stopPropagation();\n\n/**\n * Generates the format object that will be applied to the link text.\n *\n * @param {string}  url              The href of the link.\n * @param {boolean} opensInNewWindow Whether this link will open in a new window.\n * @param {Object}  text             The text that is being hyperlinked.\n *\n * @return {Object} The final format object.\n */\nfunction createLinkFormat( { url, opensInNewWindow, text } ) {\n\tconst format = {\n\t\ttype: 'core/link',\n\t\tattributes: {\n\t\t\turl,\n\t\t},\n\t};\n\n\tif ( opensInNewWindow ) {\n\t\t// translators: accessibility label for external links, where the argument is the link text\n\t\tconst label = sprintf( __( '%s (opens in a new tab)' ), text ).trim();\n\n\t\tformat.attributes.target = '_blank';\n\t\tformat.attributes.rel = 'noreferrer noopener';\n\t\tformat.attributes[ 'aria-label' ] = label;\n\t}\n\n\treturn format;\n}\n\nfunction isShowingInput( props, state ) {\n\treturn props.addingLink || state.editLink;\n}\n\nconst LinkEditor = ( { value, onChangeInputValue, onKeyDown, submitLink, autocompleteRef } ) => (\n\t// Disable reason: KeyPress must be suppressed so the block doesn't hide the toolbar\n\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t<form\n\t\tclassName=\"editor-format-toolbar__link-container-content\"\n\t\tonKeyPress={ stopKeyPropagation }\n\t\tonKeyDown={ onKeyDown }\n\t\tonSubmit={ submitLink }\n\t>\n\t\t<URLInput\n\t\t\tvalue={ value }\n\t\t\tonChange={ onChangeInputValue }\n\t\t\tautocompleteRef={ autocompleteRef }\n\t\t/>\n\t\t<IconButton icon=\"editor-break\" label={ __( 'Apply' ) } type=\"submit\" />\n\t</form>\n\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n);\n\nconst LinkViewer = ( { url, editLink } ) => {\n\tconst prependedURL = prependHTTP( url );\n\tconst linkClassName = classnames( 'editor-format-toolbar__link-container-value', {\n\t\t'has-invalid-link': ! isValidHref( prependedURL ),\n\t} );\n\n\treturn (\n\t\t// Disable reason: KeyPress must be suppressed so the block doesn't hide the toolbar\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\t<div\n\t\t\tclassName=\"editor-format-toolbar__link-container-content\"\n\t\t\tonKeyPress={ stopKeyPropagation }\n\t\t>\n\t\t\t<ExternalLink\n\t\t\t\tclassName={ linkClassName }\n\t\t\t\thref={ url }\n\t\t\t>\n\t\t\t\t{ filterURLForDisplay( safeDecodeURI( url ) ) }\n\t\t\t</ExternalLink>\n\t\t\t<IconButton icon=\"edit\" label={ __( 'Edit' ) } onClick={ editLink } />\n\t\t</div>\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t);\n};\n\nclass InlineLinkUI extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.editLink = this.editLink.bind( this );\n\t\tthis.submitLink = this.submitLink.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onChangeInputValue = this.onChangeInputValue.bind( this );\n\t\tthis.setLinkTarget = this.setLinkTarget.bind( this );\n\t\tthis.onClickOutside = this.onClickOutside.bind( this );\n\t\tthis.resetState = this.resetState.bind( this );\n\t\tthis.autocompleteRef = createRef();\n\n\t\tthis.state = {};\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\tconst { activeAttributes: { url, target } } = props;\n\t\tconst opensInNewWindow = target === '_blank';\n\n\t\tif ( ! isShowingInput( props, state ) ) {\n\t\t\tif ( url !== state.inputValue ) {\n\t\t\t\treturn { inputValue: url };\n\t\t\t}\n\n\t\t\tif ( opensInNewWindow !== state.opensInNewWindow ) {\n\t\t\t\treturn { opensInNewWindow };\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.keyCode === ESCAPE ) {\n\t\t\tevent.stopPropagation();\n\t\t\tthis.resetState();\n\t\t}\n\n\t\tif ( [ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf( event.keyCode ) > -1 ) {\n\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\tevent.stopPropagation();\n\t\t}\n\t}\n\n\tonChangeInputValue( inputValue ) {\n\t\tthis.setState( { inputValue } );\n\t}\n\n\tsetLinkTarget( opensInNewWindow ) {\n\t\tconst { activeAttributes: { url }, value, onChange } = this.props;\n\n\t\tthis.setState( { opensInNewWindow } );\n\n\t\t// Apply now if URL is not being edited.\n\t\tif ( ! isShowingInput( this.props, this.state ) ) {\n\t\t\tonChange( applyFormat( value, createLinkFormat( { url, opensInNewWindow, text: value.text } ) ) );\n\t\t}\n\t}\n\n\teditLink( event ) {\n\t\tthis.setState( { editLink: true } );\n\t\tevent.preventDefault();\n\t}\n\n\tsubmitLink( event ) {\n\t\tconst { isActive, value, onChange, speak } = this.props;\n\t\tconst { inputValue, opensInNewWindow } = this.state;\n\t\tconst url = prependHTTP( inputValue );\n\t\tconst format = createLinkFormat( { url, opensInNewWindow, text: value.text } );\n\n\t\tevent.preventDefault();\n\n\t\tif ( isCollapsed( value ) && ! isActive ) {\n\t\t\tconst toInsert = applyFormat( create( { text: url } ), format, 0, url.length );\n\t\t\tonChange( insert( value, toInsert ) );\n\t\t} else {\n\t\t\tonChange( applyFormat( value, format ) );\n\t\t}\n\n\t\tthis.resetState();\n\n\t\tif ( ! isValidHref( url ) ) {\n\t\t\tspeak( __( 'Warning: the link has been inserted but may have errors. Please test it.' ), 'assertive' );\n\t\t} else if ( isActive ) {\n\t\t\tspeak( __( 'Link edited.' ), 'assertive' );\n\t\t} else {\n\t\t\tspeak( __( 'Link inserted' ), 'assertive' );\n\t\t}\n\t}\n\n\tonClickOutside( event ) {\n\t\t// The autocomplete suggestions list renders in a separate popover (in a portal),\n\t\t// so onClickOutside fails to detect that a click on a suggestion occured in the\n\t\t// LinkContainer. Detect clicks on autocomplete suggestions using a ref here, and\n\t\t// return to avoid the popover being closed.\n\t\tconst autocompleteElement = this.autocompleteRef.current;\n\t\tif ( autocompleteElement && autocompleteElement.contains( event.target ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resetState();\n\t}\n\n\tresetState() {\n\t\tthis.props.stopAddingLink();\n\t\tthis.setState( { editLink: false } );\n\t}\n\n\trender() {\n\t\tconst { isActive, activeAttributes: { url }, addingLink, value } = this.props;\n\n\t\tif ( ! isActive && ! addingLink ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { inputValue, opensInNewWindow } = this.state;\n\t\tconst showInput = isShowingInput( this.props, this.state );\n\n\t\treturn (\n\t\t\t<PositionedAtSelection\n\t\t\t\tkey={ `${ value.start }${ value.end }` /* Used to force rerender on selection change */ }\n\t\t\t>\n\t\t\t\t<URLPopover\n\t\t\t\t\tonClickOutside={ this.onClickOutside }\n\t\t\t\t\tfocusOnMount={ showInput ? 'firstElement' : false }\n\t\t\t\t\trenderSettings={ () => (\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Open in New Tab' ) }\n\t\t\t\t\t\t\tchecked={ opensInNewWindow }\n\t\t\t\t\t\t\tonChange={ this.setLinkTarget }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t{ showInput ? (\n\t\t\t\t\t\t<LinkEditor\n\t\t\t\t\t\t\tvalue={ inputValue }\n\t\t\t\t\t\t\tonChangeInputValue={ this.onChangeInputValue }\n\t\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\t\tsubmitLink={ this.submitLink }\n\t\t\t\t\t\t\tautocompleteRef={ this.autocompleteRef }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<LinkViewer\n\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\teditLink={ this.editLink }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</URLPopover>\n\t\t\t</PositionedAtSelection>\n\t\t);\n\t}\n}\n\nexport default withSpokenMessages( InlineLinkUI );\n"]}